{% extends 'base.html' %}
{% load staticfiles %}

{% block menu-bar %}
    <div class="collapse navbar-collapse navbar-right">
        <ul class="nav navbar-nav">
            <li><a href="/home">Home</a></li>
            <li><a href="/files">Files</a></li>
            <li class="active"><a href="/dwns">Downloads</a></li>
            <li><a href="/uplds">Uploads</a></li>
        </ul>
    </div>
{% endblock %}

{% block body %}
    <div class=slider>
        <div class="container">
            {% for download in DOWNLOADS %}
                <h3>{{ download.name }}</h3>
                <div class="progress-wrap col-md-6">
                    <div class="progress">
                        <div class="progress-bar color1" role="progressbar" aria-valuenow="0" aria-valuemin="0"
                             aria-valuemax="100" id="{{ download.id }}" style="width: 0%">
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

{% endblock %}


{% block js %}
    <script type="text/javascript">

        $(document).ready(function () {
            const interval = setInterval(() => {
                $.ajax({
                    url: '/updatepb',
                    success: function (data) {
                        console.log("Here !!!!!!!!");
                        console.log(data);
                        console.log(data["history"]["range"]["last"]);
                        for (i = 0; i < parseInt(data["history"]["range"]["last"]); i++) {
                            console.log("iterations");
                            console.log(i);
                            bar = document.getElementById(i.toString());
                            progress = (data["history"][i.toString()]["copy"] / data["history"][i.toString()]["size"]) * 100
                            console.log(progress);
                            bar.style.width = progress + '%';
                            bar.innerText = progress + '%';
                            if (data["history"][i.toString()]["state"] == "failed" ||
                                data["history"][i.toString()]["state"] == "finish" ||
                                data["history"][i.toString()]["state"] == "paused"
                            ) {
                                clearInterval(interval);
                            }
                        }
                    }
                });
            }, 2000)
        });

    </script>
{% endblock %}